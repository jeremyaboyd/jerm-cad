<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JermCAD | A YAML 3D Model Renderer</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/theme/monokai.css">
</head>
<body>
    <div id="editor-panel">
        <div id="editor-toolbar" class="toolbar">
            <div class="toolbar-group">
                <button id="btn-new" class="toolbar-btn" title="New File (Ctrl+N)">
                    <span class="btn-icon">üìÑ</span>
                    <span class="btn-text">New</span>
                </button>
                <button id="btn-open" class="toolbar-btn" title="Open File (Ctrl+O)">
                    <span class="btn-icon">üìÇ</span>
                    <span class="btn-text">Open</span>
                </button>
                <button id="btn-save" class="toolbar-btn" title="Save File (Ctrl+S)">
                    <span class="btn-icon">üíæ</span>
                    <span class="btn-text">Save</span>
                </button>
                <button id="btn-export" class="toolbar-btn" title="Export STL">
                    <span class="btn-icon">üì§</span>
                    <span class="btn-text">Export</span>
                </button>
            </div>
        </div>
        <textarea id="editor" spellcheck="false"># Action Figure Body
settings:
    units: mm
    debug: false
    tolerance: 1e-3
    up: [0, 0, 1]  # Z-up (CAD convention). Use [0, 1, 0] for Y-up

materials:
    blue_plastic:
        color: 0x4287f5
        opacity: 1.0
    red_metal:
        color: 0xff0000
        opacity: 0.9
    transparent_glass:
        color: 0xffffff
        opacity: 0.5

solids:
    chest:
        shape: cuboid
        center: [0, 0, 0]
        size: [10, 20, 35]
        stamps:
            shoulder_joint_left:
                stamp: balljoint
                diameter: 10
                length: 5
                at: [0, 6, 13]
            shoulder_joint_right:
                stamp: balljoint
                diameter: 10
                length: 5
                at: [0, -6, 13]
                rotate: [0, 0, 180]

stamps:
    balljoint:
        params: [$diameter, $length]
        solids:
            outer:
                shape: sphere
                center: [0, 0, 0]
                diameter: $diameter
                modifiers:
                    boolean:
                        - difference: inner_cutout
                        - difference: inner_cutout2
            inner_cutout:
                shape: sphere
                center: [0, 0, 0]
                diameter: $diameter * 0.75
            inner_cutout2:
                shape: sphere
                center: [0, $diameter * 0.5, 0]
                diameter: $diameter * 0.75
            inner:
                shape: sphere
                center: [0, 0, 0]
                diameter: $diameter * 0.667
                modifiers:
                    boolean:
                        - union: inner_arm
            inner_arm:
                shape: cylinder
                center: [0, $diameter *0.333 + $length / 2, 0]
                diameter: $diameter * 0.2
                length: $length
        parent:
            modifiers:
                boolean:
                    - union: outer
                    - difference: inner_cutout
                    - difference: inner_cutout2

final:
    material: blue_plastic  # Apply material to the final merged mesh
    # OR use direct properties:
    # color: 0x4287f5
    # opacity: 1.0</textarea>
    </div>
    
    <div id="splitter"></div>
    
    <div id="viewer-panel">
        <div id="viewer-toolbar" class="toolbar">
            <div class="toolbar-group toolbar-group-right">
                <select id="quality-select" class="toolbar-select" title="Render Quality">
                    <option value="low" selected>Low (32)</option>
                    <option value="medium">Med (64)</option>
                    <option value="high">High (128)</option>
                    <option value="ultra">Ultra (256)</option>
                </select>
                <button id="btn-render" class="toolbar-btn toolbar-btn-primary" title="Render Model (Ctrl+Enter)">
                    <span class="btn-icon">üîÑ</span>
                    <span class="btn-text">Render</span>
                </button>
                <button id="btn-wireframe" class="toolbar-btn" title="Toggle Wireframe">
                    <span class="btn-icon">üî≤</span>
                    <span class="btn-text">Wireframe</span>
                </button>
            </div>
        </div>
        <div id="canvas-container"></div>
        <div id="error-display"></div>
        <div id="info-panel">
            <h3>Model Info</h3>
            <div id="model-stats">No model loaded</div>
            <div class="controls-info">
                <strong>Controls:</strong><br>
                üñ±Ô∏è Left Drag: Rotate<br>
                üñ±Ô∏è Right Drag: Pan<br>
                ‚öôÔ∏è Scroll: Zoom<br>
                üîÑ Middle Drag: Pan
            </div>
        </div>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "./node_modules/three/build/three.module.js",
            "three/addons/": "./node_modules/three/examples/jsm/",
            "three-mesh-bvh": "./node_modules/three-mesh-bvh/build/index.module.js",
            "three-bvh-csg": "./node_modules/three-bvh-csg/build/index.module.js"
        }
    }
    </script>
    <script src="./node_modules/js-yaml/dist/js-yaml.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/yaml/yaml.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YAML 3D Model Renderer</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div id="editor-panel">
        <div id="toolbar">
            <button id="btn-render">üîÑ Render Model</button>
            <select id="quality-select" title="Render Quality">
                <option value="low" selected>Low (32)</option>
                <option value="medium">Med (64)</option>
                <option value="high">High (128)</option>
                <option value="ultra">Ultra (256)</option>
            </select>
            <button id="btn-reset-camera">üì∑ Reset Camera</button>
            <button id="btn-wireframe">üî≤ Toggle Wireframe</button>
            <button id="btn-export">üíæ Export STL</button>
        </div>
        <textarea id="editor" spellcheck="false"># Action Figure Body
settings:
    units: mm
    debug: false
    tolerance: 1e-3
    up: [0, 0, 1]  # Z-up (CAD convention). Use [0, 1, 0] for Y-up

materials:
    blue_plastic:
        color: 0x4287f5
        opacity: 1.0
    red_metal:
        color: 0xff0000
        opacity: 0.9
    transparent_glass:
        color: 0xffffff
        opacity: 0.5

solids:
    chest:
        shape: cuboid
        center: [0, 0, 0]
        size: [10, 20, 35]
        stamps:
            shoulder_joint_left:
                stamp: balljoint
                diameter: 10
                length: 5
                at: [0, 6, 13]
            shoulder_joint_right:
                stamp: balljoint
                diameter: 10
                length: 5
                at: [0, -6, 13]
                rotate: [0, 0, 180]

stamps:
    balljoint:
        params: [$diameter, $length]
        shapes:
            outer:
                shape: sphere
                center: [0, 0, 0]
                diameter: $diameter
                modifiers:
                    boolean:
                        - difference: inner_cutout
                        - difference: inner_cutout2
            inner_cutout:
                shape: sphere
                center: [0, 0, 0]
                diameter: $diameter * 0.75
            inner_cutout2:
                shape: sphere
                center: [0, $diameter * 0.5, 0]
                diameter: $diameter * 0.75
            inner:
                shape: sphere
                center: [0, 0, 0]
                diameter: $diameter * 0.667
                modifiers:
                    boolean:
                        - union: inner_arm
            inner_arm:
                shape: cylinder
                center: [0, $diameter *0.333 + $length / 2, 0]
                diameter: $diameter * 0.2
                length: $length
        parent:
            modifiers:
                boolean:
                    - union: outer
                    - difference: inner_cutout
                    - difference: inner_cutout2

final:
    material: blue_plastic  # Apply material to the final merged mesh
    # OR use direct properties:
    # color: 0x4287f5
    # opacity: 1.0</textarea>
    </div>
    
    <div id="viewer-panel">
        <div id="canvas-container"></div>
        <div id="error-display"></div>
        <div id="info-panel">
            <h3>Model Info</h3>
            <div id="model-stats">No model loaded</div>
            <div class="controls-info">
                <strong>Controls:</strong><br>
                üñ±Ô∏è Left Drag: Rotate<br>
                üñ±Ô∏è Right Drag: Pan<br>
                ‚öôÔ∏è Scroll: Zoom<br>
                üîÑ Middle Drag: Pan
            </div>
        </div>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "./node_modules/three/build/three.module.js",
            "three/addons/": "./node_modules/three/examples/jsm/",
            "three-mesh-bvh": "./node_modules/three-mesh-bvh/build/index.module.js",
            "three-bvh-csg": "./node_modules/three-bvh-csg/build/index.module.js"
        }
    }
    </script>
    <script src="./node_modules/js-yaml/dist/js-yaml.min.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>